<!DOCTYPE html>
<html>
  <head>
    
      <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="revised" content="2022-02-12T16:55:05 UTC">
<title>Walking :: Emacs Tree-sitter</title>
<link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon" />
<link href="/css/nucleus.css" rel="stylesheet">
<link href="/css/font-awesome.min.css" rel="stylesheet">
<link href="/css/hybrid.css" rel="stylesheet">
<link href="/css/featherlight.min.css" rel="stylesheet">
<link href="/css/auto-complete.css" rel="stylesheet">
<link href="/theme-original/style.css" rel="stylesheet">

<link rel="stylesheet" href="/css/bootstrap.min.css">
<script src="/js/jquery-2.x.min.js"></script>
<style type="text/css">
  :root #header + #content > #left > #rlblock_left {
    display:none !important;
  }
</style>
<link rel="stylesheet" href="https://emacs-tree-sitter.github.io/css/syntax.css">
<link rel="stylesheet" href="https://emacs-tree-sitter.github.io/css/xxx.css">


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-138609797-2', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


    
  </head>
  <body data-url="/api/walking/">
    
      <div id="headermain"></div>
<nav id="sidebar" class="">



<div class="highlightable">
  <div id="header-wrapper">
    <div id="header">
      <img src="https://emacs-tree-sitter.github.io/img/emacs-tree-sitter-96x96.png" alt="logo">

    </div>
        <div class="searchbox">
		    <label for="search-by"><i class="fa fa-search"></i></label>
		    <input data-search-input id="search-by" type="text" placeholder="Search...">
		    <span data-search-clear=""><i class="fa fa-close"></i></span>
		</div>
		<script type="text/javascript" src="/js/lunr.min.js"></script>
		<script type="text/javascript" src="/js/auto-complete.js"></script>
		<script type="text/javascript">
        
            var baseurl = "https:\/\/emacs-tree-sitter.github.io";
        
		</script>
		<script type="text/javascript" src="/js/search.js"></script>
  </div>

      <ul class="topics">
            <li data-nav-id="/" class="dd-item">
            <a href="/"><i class="fa fa-fw fa-home"></i></a>
            </li>
      <li data-nav-id="https://emacs-tree-sitter.github.io/installation/" class="dd-item">
        <a href="/installation/">
          Installation
        </a>
    </li>
      <li data-nav-id="https://emacs-tree-sitter.github.io/getting-started/" class="dd-item">
        <a href="/getting-started/">
          Getting Started
        </a>
    </li>
      <li data-nav-id="https://emacs-tree-sitter.github.io/languages/" class="dd-item">
        <a href="/languages/">
          Languages
        </a>
    </li>
    <li data-nav-id="https://emacs-tree-sitter.github.io/syntax-highlighting/" class="dd-item alwaysopen haschildren
        ">
      <a href="/syntax-highlighting/">Syntax Highlighting</a>
            <i class="fa fa-angle-down fa-lg category-icon"></i>
        <ul>
      <li data-nav-id="https://emacs-tree-sitter.github.io/syntax-highlighting/queries/" class="dd-item">
        <a href="/syntax-highlighting/queries/">
          Queries
        </a>
    </li>
      <li data-nav-id="https://emacs-tree-sitter.github.io/syntax-highlighting/customization/" class="dd-item">
        <a href="/syntax-highlighting/customization/">
          Customization
        </a>
    </li>
      <li data-nav-id="https://emacs-tree-sitter.github.io/syntax-highlighting/interface-for-modes/" class="dd-item">
        <a href="/syntax-highlighting/interface-for-modes/">
          Interface for Modes
        </a>
    </li>
        </ul>
    </li>
    <li data-nav-id="https://emacs-tree-sitter.github.io/api/" class="dd-item parent alwaysopen haschildren
        ">
      <a href="/api/">Core APIs</a>
            <i class="fa fa-angle-down fa-lg category-icon"></i>
        <ul>
      <li data-nav-id="https://emacs-tree-sitter.github.io/api/parsing/" class="dd-item">
        <a href="/api/parsing/">
          Parsing
        </a>
    </li>
      <li data-nav-id="https://emacs-tree-sitter.github.io/api/inspecting/" class="dd-item">
        <a href="/api/inspecting/">
          Inspecting
        </a>
    </li>
      <li data-nav-id="https://emacs-tree-sitter.github.io/api/walking/" class="dd-item active">
        <a href="/api/walking/">
          Walking
        </a>
    </li>
      <li data-nav-id="https://emacs-tree-sitter.github.io/api/querying/" class="dd-item">
        <a href="/api/querying/">
          Querying
        </a>
    </li>
        </ul>
    </li>
      <li data-nav-id="https://emacs-tree-sitter.github.io/tree-sitter-mode/" class="dd-item">
        <a href="/tree-sitter-mode/">
          Tree-sitter Minor Mode
        </a>
    </li>




    <hr />
    <li></li>
    
    </ul>

 <section id="footer">
    </section>
  </div>
</nav>



<section id="body">
<div id="overlay"></div>
<div class="padding highlightable">

  <div id="top-bar">
    <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
        <span id="sidebar-toggle-span">
          <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
            <i class="fa fa-bars"></i>
          </a>
        </span>
        <span id="toc-menu"><i class="fa fa-list-alt"></i></span>
        <span class="links">
        







 <a href='https://emacs-tree-sitter.github.io/'>Tree-sitter</a> > <a href='https://emacs-tree-sitter.github.io/api/'>Core APIs</a> > Walking

 

 

   
        </span>
    </div>
    
    
    <div class="progress">
        <div class="wrapper">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#traversing-all-descendant-nodes">Traversing All Descendant Nodes</a></li>
    <li><a href="#walking-step-by-step">Walking Step-by-step</a></li>
  </ul>
</nav>
        </div>
    </div>
    

  </div>


<div id="body-inner">
  
    <h1>Walking</h1>
  



    

    
    <p>Tree-walking functions enable efficient traversal of the syntax tree.</p>
<p>When dealing with a large number of nodes, working with node objects creates a huge pressure on the garbage collector. For better performance, it&rsquo;s advisable to extract and work with individual node properties. The constant <code>tsc-valid-node-props</code> holds the list of all available property names:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="o">&#39;</span><span class="p">(</span><span class="nb">:type</span>
  <span class="nb">:field</span> <span class="c1">;node&#39;s field name within the parent node</span>
  <span class="nb">:depth</span> <span class="c1">;node&#39;s depth, relative to the iterator&#39;s start</span>
  <span class="nb">:named-p</span> <span class="nb">:extra-p</span> <span class="nb">:error-p</span> <span class="nb">:missing-p</span> <span class="nb">:has-error-p</span>
  <span class="nb">:start-byte</span> <span class="nb">:end-byte</span>
  <span class="nb">:start-point</span> <span class="nb">:end-point</span>
  <span class="nb">:range</span> <span class="nb">:byte-range</span><span class="p">)</span>
</code></pre></div>
<div class="notices note" ><p><p>Functions that accept a vector of property names can also accept a single property name, in which case only that property is returned/yielded, instead of a vector of properties.</p>
</p></div>

<h2 id="traversing-all-descendant-nodes">Traversing All Descendant Nodes</h2>
<p>These functions are high-level APIs that allow traversing the syntax tree in depth-first pre-order.</p>
<dl>
<dt><code>tsc-traverse-do</code> <em><code>(vars tree-or-node) body</code></em></dt>
<dd>Evaluate <code>body</code> with <code>vars</code> bound to corresponding properties of each traversed node.
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">tsc-traverse-do</span> <span class="p">([</span><span class="nv">type</span> <span class="nv">depth</span> <span class="nv">named-p</span><span class="p">]</span> <span class="nv">tree</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">when</span> <span class="nv">named-p</span>                         <span class="c1">;AST</span>
    <span class="p">(</span><span class="nf">insert</span> <span class="p">(</span><span class="nf">make-string</span> <span class="nv">depth</span> <span class="nv">\?</span> <span class="p">)</span>     <span class="c1">;indentation</span>
	    <span class="p">(</span><span class="nf">format</span> <span class="s">&#34;%S&#34;</span> <span class="nv">type</span><span class="p">)</span> <span class="s">&#34;\n&#34;</span><span class="p">)))</span>
</code></pre></div></dd>
<dt><code>tsc-traverse-mapc</code> <em><code>func tree-or-node [props]</code></em></dt>
<dd>Call <code>func</code> for each traversed node, passing the node as the argument. If <code>props</code> is a vector of property names, <code>func</code> receives a vector containing the node&rsquo;s properties instead. <strong>Do not keep a reference to the vector</strong>, as it is reused across invocations. Use <code>pcase-let</code> to extract the properties instead.
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">tsc-traverse-mapc</span>
 <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nv">props</span><span class="p">)</span>
   <span class="p">(</span><span class="nb">pcase-let</span> <span class="p">((</span><span class="o">`</span><span class="p">[</span><span class="o">,</span><span class="nv">type</span> <span class="o">,</span><span class="nv">depth</span> <span class="o">,</span><span class="nv">named-p</span><span class="p">]</span> <span class="nv">props</span><span class="p">))</span>
     <span class="p">(</span><span class="nb">when</span> <span class="nv">named-p</span>                          <span class="c1">;AST</span>
       <span class="p">(</span><span class="nf">insert</span> <span class="p">(</span><span class="nf">make-string</span> <span class="nv">depth</span> <span class="nv">\?</span> <span class="p">)</span>      <span class="c1">;indentation</span>
	       <span class="p">(</span><span class="nf">format</span> <span class="s">&#34;%S&#34;</span> <span class="nv">type</span><span class="p">)</span> <span class="s">&#34;\n&#34;</span><span class="p">))))</span>
 <span class="nv">tree</span>
 <span class="p">[</span><span class="nb">:type</span> <span class="nb">:depth</span> <span class="nb">:named-p</span><span class="p">])</span>
</code></pre></div></dd>
<dt><code>tsc-traverse-iter</code> <em><code>tree-or-node [props]</code></em></dt>
<dd>Create an iterator that yields traversed nodes. If <code>props</code> is a vector of property names, the iterator yields a vector containing the node&rsquo;s properties instead. <strong>Do not keep a reference to the vector</strong>, as it is reused across iterations. Use <code>pcase-let</code> to extract the properties instead.
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">iter-do</span> <span class="p">(</span><span class="nv">props</span> <span class="p">(</span><span class="nv">tsc-traverse-iter</span>
		 <span class="nv">tree</span> <span class="p">[</span><span class="nb">:type</span> <span class="nb">:depth</span> <span class="nb">:named-p</span><span class="p">]))</span>
  <span class="p">(</span><span class="nb">pcase-let</span> <span class="p">((</span><span class="o">`</span><span class="p">[</span><span class="o">,</span><span class="nv">type</span> <span class="o">,</span><span class="nv">depth</span> <span class="o">,</span><span class="nv">named-p</span><span class="p">]</span> <span class="nv">props</span><span class="p">))</span>
    <span class="p">(</span><span class="nb">when</span> <span class="nv">named-p</span>                       <span class="c1">;AST</span>
      <span class="p">(</span><span class="nf">insert</span> <span class="p">(</span><span class="nf">make-string</span> <span class="nv">depth</span> <span class="nv">\?</span> <span class="p">)</span>   <span class="c1">;indentation</span>
	      <span class="p">(</span><span class="nf">format</span> <span class="s">&#34;%S&#34;</span> <span class="nv">type</span><span class="p">)</span> <span class="s">&#34;\n&#34;</span><span class="p">))))</span>
</code></pre></div></dd>
</dl>
<h2 id="walking-step-by-step">Walking Step-by-step</h2>
<p>These functions are the low-level APIs that allow walking through the syntax tree one node at a time, with the help of a stateful <code>cursor</code> object.</p>
<dl>
<dt><code>tsc-make-cursor</code> <em><code>tree-or-node</code></em></dt>
<dd>Create a new cursor on a node. The cursor <em>cannot move out</em> of this node. If called on a tree, the cursor is created on the tree&rsquo;s root node.</dd>
<dt><code>tsc-goto-parent</code> <em><code>cursor</code></em></dt>
<dd><!-- raw HTML omitted -->
</dd>
<dt><code>tsc-goto-first-child</code> <em><code>cursor</code></em></dt>
<dd><!-- raw HTML omitted -->
</dd>
<dt><code>tsc-goto-next-sibling</code> <em><code>cursor</code></em></dt>
<dd>Attempt to move the cursor to the parent node, the first child node, or the next sibling node. This function returns t if the move was successful, nil if the move is invalid.</dd>
<dt><code>tsc-goto-first-child-for-position</code> <em><code>cursor pos</code></em></dt>
<dd>Attempt to move the cursor to the first child node that extends beyond the given position. This function returns the index of the child node found, nil otherwise.</dd>
<dt><code>tsc-reset-cursor</code> <em><code>cursor node</code></em></dt>
<dd>Re-initialize the cursor to start on a different node.</dd>
<dt><code>tsc-current-node</code> <em><code>cursor [props] [output]</code></em></dt>
<dd>Get the node that the cursor is currently on. If <code>props</code> is a vector of property names, return a vector containing the node&rsquo;s corresponding properties. If <code>output</code> is also non-nil, it must be a vector of the same length, where the properties will be written into.</dd>
<dt><code>tsc-current-field</code> <em><code>cursor</code></em></dt>
<dd>Get the field name (as a keyword) associated with the current node. This is equivalent to:
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">tsc-current-node</span> <span class="nv">cursor</span> <span class="nb">:field</span><span class="p">)</span>
</code></pre></div></dd>
</dl>



    
          <footer class=" footline" >
	
</footer>
  </div>
</div>

<div id="navigation">
  <a class="nav nav-prev" href="/api/inspecting/" title="Inspecting"> <i class="fa fa-chevron-left"></i><label>Inspecting</label></a>
    <a class="nav nav-next" href="/api/querying/" title="Querying" style="margin-right: 0px;"><label>Querying</label><i class="fa fa-chevron-right"></i></a></div>


</section>
<div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
  <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
</div>    

<script src="/js/clipboard.min.js"></script>
<script src="/js/featherlight.min.js"></script>
<script src="/js/html5shiv-printshiv.min.js"></script>

<script src="/js/modernizr.custom.71422.js"></script>
<script src="/js/docdock.js"></script>
<script src="/theme-original/script.js"></script>


    

    
    

    
  </body>
</html>
